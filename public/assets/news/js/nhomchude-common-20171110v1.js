function getlikeFb(t, n, e, a) { $.ajax({ type: "GET", dataType: "json", url: "https://sharefb.cnnd.vn/?urls=" + t, success: function (t) { try { if (null != n && $(n).html(t[0].share_count), null != e && t[0].like_count && ($(e).html(t[0].like_count), t[0].like_count < 10 ? $(e).hide() : $(e).show()), null != a && t[0].total_count) { var i = t[0].total_count >= 1e6 ? "0.0a" : "0,0a", l = numeral(t[0].total_count).format(i).replace(",", "."); $(a).html(l), t[0].total_count < 10 ? $(a).hide() : $(a).show() } } catch (s) { } } }) } function showTag(t) { tagUrlActive = t, pageIndex = 1, isActiveTopic = 0, loadTag(t, pageIndex, pageSize) } function activeTab(t) { $(t).parent().parent().find("li.tbwnwl").removeClass("active"), $(t).parent().addClass("active") } function changeViewMode() { if (1 == viewmode && ($("#liListView").removeClass("active"), $("#liGridView").addClass("active"), $(".tbw-layout").hasClass("tnwmw-list-content"))) { $(".tbw-layout").removeClass("tnwmw-list-content"), $(".tbw-layout").addClass("tnwmw-grid-content"), $("ul.tbwnw-list-news .tbwnwln .tbwnwln-info .tbwcwiu-info").timeago(), $("img.lazy").lazyload(); var t = 1 == viewmode ? 438 : 250; $("body").hasClass("safari") ? ($(".tbw-layout .tbwnwln").css("height", t), struncateString("#tbwnw-list-news .tbwnwln .tbwnwln-title a", 75), struncateString("#tbwnw-list-news .tbwnwln .tbwnln-sapo", 130)) : (equalheight(".tbw-layout .tbwnwln"), $("#tbwnw-list-news .tbwnwln .tbwnln-sapo").trimLine(3), $("#tbwnw-list-news .tbwnwln .tbwnwln-title a").trimLine(3)) } } function goBack() { 1439 == topicId ? window.history.back() : window.location.href = "/" } function closeFancybox() { $.fancybox.close() } function listener(t) { "http://comment.vietid.net" == t.origin && $(".fancybox-iframe").contents().find("#mingid_comment_iframe").css("height", t.data) } function viewMore() { 0 == checkLoad && (checkLoad = 1, $(".load-stream-animation").show(), $(".view-more-detail").hide(), setTimeout(function () { 1 == isActiveTopic ? loadTopic(topicname, pageIndex, pageSize) : loadTag(tagUrlActive, pageIndex, pageSize), pageIndex++ }, 1200)) } function loadTopic(t, n, e) { isActiveTopic = 1, $.ajax({ url: Constants.apiHandlerUrl + "/Handler/NhomChuDe/TopicData.ashx", data: { c: "getnewstopic", threadname: t, page: n, size: e }, dataType: "json", type: "GET", success: function (t) { if (null == t) $(".tbw-page-wrapper").hide(), isTheEnd = !0; else if (t.Success) if (0 == t.Data.length) isTheEnd = !0; else { $(".load-stream-animation").hide(); var e = ""; $.each(t.Data, function (t, n) { newsIds.indexOf(n.Url) < 0 && (e += 1443 == topicId ? getLiContent1(n.NewsId, n.Url, n.Alt, n.OriginalBigAvatar, n.Title, n.Sapo, n.DistributionDate, n.CatUrl, n.CatName) : getLiContent(n.NewsId, n.Url, n.Alt, n.OriginalBigAvatar, n.Title, n.Sapo, n.DistributionDate, n.CatUrl, n.CatName)) }), 1 == n ? $("#tbwnw-list-news").html(e) : $("#tbwnw-list-news").append(e), callAfterLoadData() } checkLoad = 0, $(".load-stream-animation").hide() } }) } function loadTag(t, n, e) { isActiveTopic = 0, $.ajax({ url: Constants.apiHandlerUrl + "/Handler/NhomChuDe/TopicData.ashx", data: { c: "getnewstag", tagurl: t, page: n, size: e }, dataType: "json", type: "GET", success: function (t) { if (null != t) { if (t.Success) if (0 == t.Data.length) isTheEnd = !0; else { var e = ""; $.each(t.Data, function (t, n) { e += 1443 == topicId ? getLiContent1(n.NewsId, n.Url, n.TitleEncode, n.ThumbImage421x263, n.Title, n.Sapo, n.DistributionDate, n.ParentZoneUrl, n.ParentZoneName) : getLiContent(n.NewsId, n.Url, n.TitleEncode, n.ThumbImage421x263, n.Title, n.Sapo, n.DistributionDate, n.ParentZoneUrl, n.ParentZoneName) }), 1 == n ? $("#tbwnw-list-news").html(e) : $("#tbwnw-list-news").append(e), callAfterLoadData() } } else isTheEnd = !0; checkLoad = 0, $(".load-stream-animation").hide(), 1 == n && pageIndex++ } }) } function callAfterLoadData() { $("ul.tbwnw-list-news .tbwnwln .tbwnwln-info .tbwcwiu-info").timeago(), $("img.lazy").lazyload(); var t = 1 == viewmode ? 438 : 250; $("body").hasClass("safari") ? ($(".tbw-layout .tbwnwln").css("height", t), struncateString("#tbwnw-list-news .tbwnwln .tbwnwln-title a", 75), struncateString("#tbwnw-list-news .tbwnwln .tbwnln-sapo", 130)) : ($(".tbw-layout").waitForImages(function () { equalheight(".tbw-layout .tbwnwln") }), $("#tbwnw-list-news .tbwnwln .tbwnln-sapo").trimLine(3), $("#tbwnw-list-news .tbwnwln .tbwnwln-title a").trimLine(3)), 1443 == topicId && ($(".k14-topic-fancy").attr("target", "_blank"), $(".k14-topic-fancy").removeClass("k14-topic-fancy"), getCountCommentLinkNotReturn("#tbwnw-list-news", !0), $(".need-get-value-facebook").each(function () { $(this).attr("rel") && getlikeFb(Constants.host + $(this).attr("rel"), null, null, $(this)), $(this).removeClass("need-get-value-facebook") })), 1439 != topicId && popupNews.addNewsEventClick(".k14-topic-fancy") } function BuildShareUrl(t) { var n = "/news-{0}.chn"; return String.format(n, t) } function getLiContent(t, n, e, a, i, l, s, o, w) { var c = ""; return c += '<li class="tbwnwln clearfix">', c += '    <a href="' + n + '" class="tbwnwln-thumb k14-topic-fancy fancybox.iframe" title="' + e + '" newsId="' + t + '"><img class="lazy" data-original="' + a + '" title="' + e + '" alt="' + e + '"></a>', c += '    <div class="tbwnwln-info">', c += '        <h3 class="tbwnwln-title"><a href="' + n + '" class="k14-topic-fancy fancybox.iframe" title="' + e + '" newsId="' + t + '">' + i + "</a></h3>", c += '        <div class="tbwcw-info-user">', c += '            <span class="tbwcwiu-info" title="' + s + '">' + s + "</span>", c += "        </div>", c += '        <span class="tbwnln-sapo">' + l + "</span>", c += '        <div class"clearfix><a href="' + o + '" class="tbwnwln-category fr" title="' + w + '">' + w + "</a></div>", c += "    </div>", c += "</li>" } function getLiContent1(t, n, e, a, i, l, s, o, w) { var c = ""; return c += '<li class="tbwnwln clearfix">', c += '    <a href="' + n + '" class="tbwnwln-thumb k14-topic-fancy fancybox.iframe" title="' + e + '" newsId="' + t + '"><img class="lazy" data-original="' + a + '" title="' + e + '" alt="' + e + '"></a>', c += '    <div class="tbwnwln-info">', c += '        <h3 class="tbwnwln-title"><a href="' + n + '" class="k14-topic-fancy fancybox.iframe" title="' + e + '" newsid="' + t + '">' + i + "</a></h3>", c += '        <div class="tbwcw-info-user">', c += '            <span class="tbwcwiu-cate"><a href="' + o + '" title="' + w + '">' + w + "</a></span>", c += "            <span>-</span>", c += '            <span class="tbwcwiu-info" title="' + s + '">' + s + "</span>", c += "        </div>", c += '        <span class="tbwnln-sapo">' + l + "</span>", c += "    </div>", c += '    <div class="tbwcw-static-wrapper">', c += '        <a href="' + n + '#mingid_comments_content" class="item-comment kscndsl-comment" style="display:none;" rel="' + Constants.host + BuildShareUrl(t) + '"></a>', c += '        <label class="kscndsl-facebook need-get-value-facebook" style="display:none;" rel="' + BuildShareUrl(t) + '"></label>', c += "    </div>", c += "</li>" } var refTitle = document.title, refUrl = window.location.pathname; history.scrollRestoration = "manual", -1 != navigator.userAgent.indexOf("Safari") && -1 == navigator.userAgent.indexOf("Chrome") && $("body").addClass("safari k14-topic-brightlgbt magazine-topic-body"); var homeUrl = window.location.pathname, pageIndex = 2, isActiveTopic = 1, tagUrlActive = ""; $(document).ready(function () { $(".tbwcwiu-info").timeago(), $(".tbw-hightlights-wrapper .tbwhw-list .tbwhwl .tbwhwl-sapo").trimLine(3), changelayout.init(), getCountCommentLinkNotReturn(".top-data", !0), $(".need-get-value-facebook").each(function () { $(this).attr("rel") && getlikeFb(Constants.host + $(this).attr("rel"), null, null, $(this)), $(this).removeClass("need-get-value-facebook") }), changeViewMode(), 1443 == topicId && ($(".k14-topic-fancy").attr("target", "_blank"), $(".k14-topic-fancy").removeClass("k14-topic-fancy")), 1439 == topicId ? $(".k14-topic-fancy").fancybox({ maxWidth: "100%", maxHeight: "100%", fitToView: !0, width: "100%", height: "100%", autoSize: !0, padding: 0, margin: 0, beforeShow: function () { $("body").addClass("k14-topic-lightbox"), $(".fancybox-overlay").addClass("popup-topic-detail"), $(".fancybox-skin").append('<a href="/" class="ths-topic">Nhóm chủ đề</a>'); var t = $(this).attr("href"); history.replaceState("magazine", null, t) }, beforeClose: function () { $(".fancybox-overlay").addClass("popup-topic-detail-close"), history.replaceState("home", null, homeUrl) }, iframe: { scrolling: "auto", preload: !1 }, tpl: { closeBtn: '<a title="Close" class="fancybox-item fancybox-close" href="javascript:;">' + topicnamefull + "</a>" }, title: null }) : (popupNews.init(), popupNews.addNewsEventClick(".k14-topic-fancy")), $("img.lazy").lazyload(); var t = 1 == viewmode ? 438 : 250; $("body").hasClass("safari") ? ($(".tbw-layout .tbwnwln").css("height", t), struncateString("#tbwnw-list-news .tbwnwln .tbwnwln-title a", 75), struncateString("#tbwnw-list-news .tbwnwln .tbwnln-sapo", 130)) : (equalheight(".tbw-layout .tbwnwln"), $("#tbwnw-list-news .tbwnwln .tbwnln-sapo").trimLine(3), $("#tbwnw-list-news .tbwnwln .tbwnwln-title a").trimLine(3)) }); var changelayout = { init: function () { $(".tbwnwfil-button").click(function (t) { t.preventDefault(), $(this).parent().parent().find("li").removeClass("active"), $(this).parent().addClass("active"), $(this).hasClass("grid") ? (viewmode = 1, $(".tbw-layout").removeClass("tnwmw-list-content"), $(".tbw-layout").addClass("tnwmw-grid-content")) : $(".tbw-layout").hasClass("tnwmw-grid-content") && (viewmode = 0, $(".tbw-layout").removeClass("tnwmw-grid-content"), $(".tbw-layout").addClass("tnwmw-list-content")); var n = 1 == viewmode ? 438 : 250; $("body").hasClass("safari") ? ($(".tbw-layout .tbwnwln").css("height", n), struncateString("#tbwnw-list-news .tbwnwln .tbwnwln-title a", 75), struncateString("#tbwnw-list-news .tbwnwln .tbwnln-sapo", 130)) : (equalheight(".tbw-layout .tbwnwln"), $("#tbwnw-list-news .tbwnwln .tbwnln-sapo").trimLine(3), $("#tbwnw-list-news .tbwnwln .tbwnwln-title a").trimLine(3)) }) } }; fbClient.init(), window.addEventListener("popstate", function (t) { "magazine" == t.state && ($.fancybox.close(), history.replaceState("home", null, homeUrl)) }), window.addEventListener ? addEventListener("message", listener, !1) : attachEvent("onmessage", listener); var tbwnwlnHeight = 1 == viewmode ? 438 : 250; $("body").hasClass("safari") ? ($(".tbw-layout .tbwnwln").css("height", tbwnwlnHeight), struncateString("#tbwnw-list-news .tbwnwln .tbwnwln-title a", 75), struncateString("#tbwnw-list-news .tbwnwln .tbwnln-sapo", 130)) : (equalheight(".tbw-layout .tbwnwln"), $("#tbwnw-list-news .tbwnwln .tbwnln-sapo").trimLine(3), $("#tbwnw-list-news .tbwnwln .tbwnwln-title a").trimLine(3)); var MAX_INT = 4294967295, newsIds = "", cnt = 0, checkLoad = 0; $(".news-title").each(function () { var t = $(this).attr("href"); newsIds += 0 == cnt ? t : "," + t, cnt++ }); var isTheEnd = !1; $(window).scroll(function () { if (!isTheEnd) { var t = $("#footerLoadListDetail").offset().top, n = $(window).scrollTop(); n >= t - 1700 && (2 >= pageIndex || (pageIndex - 1) % 2 != 1 ? (viewMore(), $(".view-more-detail").hide(), $(".kb-footer-area").hide()) : 0 == checkLoad && ($(".view-more-detail").show(), $(".kb-footer-area").show())); var e = $("#headerLoadTopic").offset().top; n >= e ? $("#ths-topic-name").html(topicnamefull) : $("#ths-topic-name").html("Nhóm chủ đề") } });